<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>إعدادات اللعبة</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      background-image: url("Images/back.png");
      padding: 20px;
      direction: rtl;
      text-align: center;
    }

    h1 {
      margin-bottom: 20px;
    }

    .group-input, .settings-block {
      margin: 10px auto;
      padding: 15px;
      border: 1px solid #2a2828;
      border-radius: 16px;
      background-color: #666666;
      width: 350px;
      text-align: center;
    }

    .group-input label, .settings-block label {
      display: inline-block;
      margin: 5px 0;
    }

    input[type="text"], input[type="color"], input[type="number"], select {
      margin: 5px 0;
      padding: 5px;
      font-size: 14px;
      width: 50px;
      text-align: center;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      color: white;
      border: none;
      border-radius: 8px;
    }

    select {
      padding: 8px;
      font-size: 16px;
      border-radius: 6px;
      margin-top: 10px;
    }

    .stone-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .stone-row img {
      width: 40px;
    }

    #startButton {
      background-image: url("images/button-bg.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      width: 180px;
      height: 60px;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>إعداد اللعبة</h1>

  <!-- عدد المجموعات -->
  <div class="settings-block">
    <label>عدد المجموعات:</label>
    <select id="groupCount" onchange="renderGroupInputs()">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
      <option value="9">9</option>
      <option value="10">10</option>
    </select>
  </div>

  <!-- إدخال المجموعات -->
  <div id="groupsContainer"></div>

  <!-- إعدادات الهجوم -->
  <div class="settings-block">
    <h3>إعدادات الهجوم</h3>
    <label>تكلفة الهجوم (المهاجم):</label>
    <input type="number" id="attackCost" value="10"><br>
    <label>قيمة الضرر (المهجوم عليه):</label>
    <input type="number" id="damageValue" value="5">
  </div>

  <!-- إعداد النقاط ونسبة الظهور -->
  <div class="settings-block">
    <h3>النقاط ونسبة الظهور لكل حجر</h3>

    <div class="stone-row">
      <img src="images/1.png" alt="1">
      <label>نقاط:</label>
      <input type="number" id="points1" value="1">
      <label>الظهور:</label>
      <input type="text" class="probability" id="prob1" value="20%">
    </div>

    <div class="stone-row">
      <img src="images/2.png" alt="2">
      <label>نقاط:</label>
      <input type="number" id="points2" value="2">
      <label>الظهور:</label>
      <input type="text" class="probability" id="prob2" value="20%">
    </div>

    <div class="stone-row">
      <img src="images/3.png" alt="3">
      <label>نقاط:</label>
      <input type="number" id="points3" value="3">
      <label>الظهور:</label>
      <input type="text" class="probability" id="prob3" value="20%">
    </div>

    <div class="stone-row">
      <img src="images/4.png" alt="4">
      <label>نقاط:</label>
      <input type="number" id="points4" value="4">
      <label>الظهور:</label>
      <input type="text" class="probability" id="prob4" value="20%">
    </div>

    <div class="stone-row">
      <img src="images/5.png" alt="5">
      <label>نقاط:</label>
      <input type="number" id="points5" value="5">
      <label>الظهور:</label>
      <input type="text" class="probability" id="prob5" value="20%">
    </div>
  </div>

  <button id="startButton" onclick="saveSettings()">بدء اللعبة</button>

  <script>
    function renderGroupInputs() {
      const count = parseInt(document.getElementById("groupCount").value);
      const container = document.getElementById("groupsContainer");
      container.innerHTML = "";

      for (let i = 1; i <= count; i++) {
        const div = document.createElement("div");
        div.className = "group-input";
        div.innerHTML = `
          <label>اسم المجموعة ${i}:</label>
          <input type="text" id="groupName${i}" placeholder="مثال: فريق ${i}">
          <label>اللون:</label>
          <input type="color" id="groupColor${i}" value="#${Math.floor(Math.random()*16777215).toString(16)}">
        `;
        container.appendChild(div);
      }
    }

    function saveSettings() {
      const count = parseInt(document.getElementById("groupCount").value);
      const groups = [];

      for (let i = 1; i <= count; i++) {
        const name = document.getElementById(`groupName${i}`).value || `مجموعة ${i}`;
        const color = document.getElementById(`groupColor${i}`).value;
        groups.push({ name, color });
      }

      const probabilities = [
        parseInt(document.getElementById("prob1").value.replace('%', '')) / 100,
        parseInt(document.getElementById("prob2").value.replace('%', '')) / 100,
        parseInt(document.getElementById("prob3").value.replace('%', '')) / 100,
        parseInt(document.getElementById("prob4").value.replace('%', '')) / 100,
        parseInt(document.getElementById("prob5").value.replace('%', '')) / 100
      ];

      const totalProb = probabilities.reduce((a, b) => a + b, 0);
      if (Math.abs(totalProb - 1) > 0.01) {
        alert("يجب أن يكون مجموع نسب الظهور = 100%");
        return;
      }

      const settings = {
        groups,
        attackCost: parseInt(document.getElementById("attackCost").value),
        damageToTarget: parseInt(document.getElementById("damageValue").value),
        points: [
          parseInt(document.getElementById("points1").value),
          parseInt(document.getElementById("points2").value),
          parseInt(document.getElementById("points3").value),
          parseInt(document.getElementById("points4").value),
          parseInt(document.getElementById("points5").value)
        ],
        probabilities
      };

      localStorage.setItem("gameConfig", JSON.stringify(settings));
      window.location.href = "game.html";
    }

    function setupPercentageInputs() {
      document.querySelectorAll('.probability').forEach(input => {
        input.addEventListener('blur', () => {
          if (!input.value.includes('%')) {
            input.value += '%';
          }
        });

        input.addEventListener('focus', () => {
          input.value = input.value.replace('%', '');
        });
      });
    }

    // تنفيذ عند تحميل الصفحة
    renderGroupInputs();
    setupPercentageInputs();
  </script>

</body>
</html>
